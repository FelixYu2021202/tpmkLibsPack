// ==UserScript==
// @name         Hfoj Better
// @namespace    http://hfoj.net/
// @version      1.0.0
// @description  Add functions to hfoj
// @author       cosf
// @match        http://*.hfoj.net/*
// @icon         http://hfoj.net/favicon.ico
//
// @require      https://code.jquery.com/jquery-3.7.1.min.js
// ==/UserScript==
!function(){"use strict";"undefined"==typeof $&&($=require("jquery"));const e=location.pathname,t=e.match(/\/d\/(\w+)/)?.[1],i=t?e.replace(/\/d\/(\w+)/,""):e,l=(function(e){let t={};e.substring(1).split("&").forEach((e=>{let i=e.split("=");t[i[0]]=i[1]}))}(location.search),[atob("SGFwcHlib2IgU2F5cyBZb3hp"),atob("SGFwcHlib2Igc2F5cyAiQ3VhenlveGkgeW94aSEi"),atob("RG9uJ3QgYmUgZGVjYWRlbnQhIQ==")]),s=["其他 (0)","入门 (1)","普及- (2)","普及/提高- (3)","普及+/提高 (4)","提高+/省选- (5)","省选/NOI- (6)","NOI/NOI+/CTSC (7)","(8)","(9)","(10)"];localStorage.getItem("selectedDifficulties")||localStorage.setItem("selectedDifficulties","[1,1,1,1,1,1,1,1]");const a=JSON.parse(localStorage.getItem("selectedDifficulties")),c=["unselected","selected"];$("<style>.section{border-radius:10px;}.exrand-block{width:20px;height:20px;margin:10px;border:1px solid black;display:block;text-align:center;line-height:20px;}.exrand-selector {display:flex;}.exrand-text{margin-top:10px;margin-bottom:10px;line-height:20px;}*[unselected]{background-color:var(--exrand-unselected);}*[selected]{background-color:var(--exrand-selected);}*{--exrand-selected:rgb(60 65 80);--exrand-unselected:rgb(255 255 255);}</style>").appendTo($(document.body)),"/"==i&&$(".section.side.nojs--hide")[1].remove();$(`<div class="section side visible"style="border-radius:10px;"><div class="section__header"><h1 class="section__title">一言</h1><p>${l[Math.floor(Math.random()*l.length)]}</p></div></div>`).prependTo($(".large-3,.medium-3")[0]);let d=$('<div class="section side visible"style="border-radius:10px;"><div class="section__header"><h1 class="section__title">随机 ex</h1></div></div>').prependTo($(".large-3,.medium-3")[0]),o=$('<div class="section__body"></div>').appendTo(d);if(e.match(/\/p\/\w+/)){let e=$("*:contains(难度).problem__tag-item");e.text(e.text().replace(/\d+/,(e=>s[e])))}class n{constructor(e,t){this.jqe=$(`<div class="exrand-selector"><span class="exrand-text">${s[e]}</span></div>`).appendTo(t),this.box=$(`<span class="exrand-block" ${c[a[e]]}></span>`).prependTo(this.jqe),this.jqe.on("click",(()=>{this.box.removeAttr(c[a[e]]),a[e]=1-a[e],localStorage.setItem("selectedDifficulties",JSON.stringify(a)),this.box.attr(c[a[e]],"")}))}}for(let e=0;e<8;e++)new n(e,o);$('<div><p class="expanded button">随机</p></div>').appendTo(o).on("click",(()=>{let e="";a.forEach(((t,i)=>{t&&(e+=","+i)})),e=e.substring(1),t?$.get(`/d/${t}/p?q=difficulty:${e}`,(i=>{let l=Number(i.match(/(\d+) 道题/)[1]),s=Math.ceil(Math.random()*l),a=Math.ceil(s/100),c=(s-1)%100+1;$.get(`/d/${t}/p?q=difficulty:${e}&page=${a}`,(e=>{let i=$(e).find(".col--pid")[c].innerText;location=`/d/${t}/p/${i}`}))})):$.get(`/p?q=difficulty:${e}`,(t=>{let i=Number(t.match(/(\d+) 道题/)[1]),l=Math.ceil(Math.random()*i),s=Math.ceil(l/100),a=(l-1)%100+1;$.get(`/p?q=difficulty:${e}&page=${s}`,(e=>{let t=$(e).find(".col--pid")[a].innerText;location=`/p/${t}`}))}))}))}();